function GetQueryString(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=window.location.search.substr(1).match(t);return null!=n?n[2]:null}var egret=window.egret,__reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(r,i){function o(e){try{c(a.next(e))}catch(t){i(t)}}function s(e){try{c(a["throw"](e))}catch(t){i(t)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,s)}c((a=a.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return a([e,t])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(o=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[0,o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(a){n=[6,a],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},OfflineModal=function(e){function t(){var t=e.call(this)||this;t.width=408,t.height=262,t.x=(UIConfig.width-408)/2,t.y=80;var n=new Bitmap("modal-bg_png");t.addChild(n);var a=new Bitmap("modal-title_png");t.addChild(a),a.x=166,a.y=10,t.spText=new TextField({size:22,y:100,x:0,width:408,text:"\u60a8\u5df2\u65ad\u5f00\u8fde\u63a5\uff0c\u5373\u5c06\u9000\u51fa\u6e38\u620f...",color:9065518,bold:!0,textAlign:"center"}),t.addChild(t.spText);var r=new Bitmap("btn-sure_png");return t.addChild(r),r.x=100,r.y=170,r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EventManager.pub("closeGame"),EventManager.pub("modal/onCloseOffline")},t),t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(OfflineModal.prototype,"OfflineModal");var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(){RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(e){"preload"==e.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.createGameScene(),LoginManager.gameLogin(),EventManager.pub("tiki/init"))},t.prototype.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},t.prototype.onResourceProgress=function(e){if("preload"==e.groupName){var t=Math.floor(100*(e.itemsLoaded-1)/e.itemsTotal);100==t&&(t=99),EventManager.pub("tiki/setProgress",t)}},t.prototype.createGameScene=function(){var e=this;setTimeout(function(){EventManager.pub("tiki/setProgress",100)},300),UImanager=new UIManager(this),UImanager.to("game"),this.gameBgm=RES.getRes("carbgm_mp3"),EventManager.sub("tiki/musicLoadSuc",function(){e.soundChannel&&(e.soundChannel.stop(),e.soundChannel=null),e.soundChannel=e.gameBgm.play(0,-1),GameDataManager.recoredSoundType=!0}),EventManager.sub("tiki/musicStop",function(){e.soundChannel&&(e.soundChannel.stop(),e.soundChannel=null,console.log("\u539f\u58f0\u97f3\u79fb\u9664")),GameDataManager.recoredSoundType=!1})},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Bitmap=function(e){function t(t){var n=e.call(this)||this,a=n;return"string"==typeof t?a.src=t:"object"==typeof t&&(void 0!=t.source&&(a.src=t.source),void 0!=t.width&&(a.width=t.width),void 0!=t.height&&(a.height=t.height),void 0!=t.x&&(a.x=t.x),void 0!=t.y&&(a.y=t.y),void 0!=t.rotation&&(a.rotation=t.rotation),t.anchorCenter?(a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2):(void 0!=t.anchorOffsetX&&(a.anchorOffsetX=t.anchorOffsetX),void 0!=t.anchorOffsetY&&(a.anchorOffsetY=t.anchorOffsetY)),void 0!=t.alpha&&(a.alpha=t.alpha),void 0!=t.visible&&(a.visible=t.visible),void 0!=t.touchEnabled&&(a.touchEnabled=t.touchEnabled)),n}return __extends(t,e),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e,this.texture=RES.getRes(e)},enumerable:!0,configurable:!0}),t}(egret.Bitmap);__reflect(Bitmap.prototype,"Bitmap");var BitmapText=function(e){function t(t){var n=e.call(this)||this,a=n;return"string"==typeof t?a.src=t:"object"==typeof t&&(void 0!=t.source&&(a.src=t.source),void 0!=t.width&&(a.width=t.width),void 0!=t.height&&(a.height=t.height),void 0!=t.text&&(a.text=t.text),void 0!=t.textAlign&&(a.textAlign=t.textAlign),void 0!=t.verticalAlign&&(a.verticalAlign=t.verticalAlign),void 0!=t.letterSpacing&&(a.letterSpacing=t.letterSpacing),void 0!=t.lineSpacing&&(a.lineSpacing=t.lineSpacing),void 0!=t.x&&(a.x=t.x),void 0!=t.y&&(a.y=t.y),void 0!=t.anchorOffsetX&&(a.anchorOffsetX=t.anchorOffsetX),void 0!=t.anchorOffsetY&&(a.anchorOffsetY=t.anchorOffsetY),void 0!=t.scaleX&&(a.scaleX=t.scaleX),void 0!=t.scaleY&&(a.scaleY=t.scaleY)),n}return __extends(t,e),Object.defineProperty(t.prototype,"cont",{get:function(){return this._cont},set:function(e){this._cont=e,this.text=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e,this.font=RES.getRes(e)},enumerable:!0,configurable:!0}),t}(egret.BitmapText);__reflect(BitmapText.prototype,"BitmapText");var Button=function(e){function t(t){var n=e.call(this)||this;n.bg=new Bitmap(""),n._text=new Bitmap(""),n._defaultRes="",n._selectedRes="",n._disabledRes="",n.touchScale=1,n._status="default",n._textdefault="",n._textselected="";var a=n;return n.addChild(n.bg),n.addChild(n._text),"string"==typeof t?(a._defaultRes=t,a.setStatus("default")):(t.textEnable&&(a._textEnable=t.textEnable),t.textDefault&&(a._textdefault=t.textDefault),t.textSelected&&(a._textselected=t.textSelected),a._defaultRes=t["default"]||"",a._selectedRes=t.selected||"",a._disabledRes=t.disabled||"",a.touchScale=t.touchScale||1,a.setStatus("default"),a.width=t.width||a.width,a.height=t.height||a.height,a._index=t.index||0,a._id=t.id||"id"),a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=a.width/2,a.y=a.height/2,t.x&&(a.x=t.x),t.y&&(a.y=t.y),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){this.changeScale(a.touchScale)},n),a.addEventListener(egret.TouchEvent.TOUCH_END,function(){this.changeScale(1)},n),a.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){this.changeScale(1)},n),n}return __extends(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"texture",{set:function(e){var t=e;"string"==typeof e&&(t=RES.getRes(e)),this.bg.texture=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultRes",{set:function(e){this._defaultRes=e,this.setStatus("default")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"selectedRes",{set:function(e){this._selectedRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disabledRes",{set:function(e){this._disabledRes=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"status",{get:function(){return this._status},set:function(e){this._status=e,this.setStatus(e)},enumerable:!0,configurable:!0}),t.prototype.changeScale=function(e){egret.Tween.removeTweens(this),egret.Tween.get(this).to({scaleX:e,scaleY:e},50)},t.prototype.setStatus=function(e){var t=this;switch(e){case"default":""!=t._defaultRes&&(this.bg.texture=RES.getRes(t._defaultRes)),t.touchEnabled=!0;break;case"selected":""!=t._selectedRes&&(this.bg.texture=RES.getRes(t._selectedRes)),t.touchEnabled=!0;break;case"disabled":console.log(t._disabledRes,""!=t._disabledRes),""!=t._disabledRes&&(this.bg.texture=RES.getRes(t._disabledRes)),t.touchEnabled=!1}return t._status=e,t._textEnable&&(""!=t["_text"+e]&&(this._text.texture=RES.getRes(t["_text"+e])),t._text.x=(t.width-t._text.width)/2,t._text.y=(t.height-t._text.height)/2),e},t}(egret.Sprite);__reflect(Button.prototype,"Button");var GameUtil=function(){function e(){}return e.hitTest=function(e,t){var n=e.getBounds(),a=t.getBounds();return n.x=e.x-e.width/2,n.y=e.y-e.height/2,a.x=t.x,a.y=t.y,n.intersects(a)},e.hitTest2=function(e,t){var n=e.getBounds(),a=t.getBounds();return n.x=e.x-e.width/2,n.y=e.y-e.height/2,a.x=t.x-t.width/2,a.y=t.y-t.height/2,n.intersects(a)},e}();__reflect(GameUtil.prototype,"GameUtil");var ImageLoader=function(e){function t(t){var n=e.call(this)||this,a=n;return a.imgMask=t.mask||null,a.W=t.width||0,a.H=t.height||0,t.maskConfig&&(a.imgMask=new egret.Shape,a.imgMask.graphics.beginFill(13421772),a.imgMask.graphics.drawRoundRect(0,0,t.maskConfig[0]||0,t.maskConfig[1]||0,t.maskConfig[2]||0),a.imgMask.graphics.endFill()),a.src=t.src,n.x=t.x||n.x,n.y=t.y||n.y,n}return __extends(t,e),Object.defineProperty(t.prototype,"src",{get:function(){return this._src},set:function(e){this._src=e,this.setSrc(e)},enumerable:!0,configurable:!0}),t.prototype.setSrc=function(e){var t=this;if(e){var n=new egret.ImageLoader;n.once(egret.Event.COMPLETE,function(e){t.removeChildren();var n=e.currentTarget,a=new egret.Texture;a._setBitmapData(n.data),t.image=new egret.Bitmap(a),t.W&&(t.image.scaleX=t.W/t.image.width),t.H&&(t.image.scaleY=t.H/t.image.height),t.imgMask&&(t.addChild(t.imgMask),t.image.mask=t.imgMask),t.addChild(t.image)},this),n.load(e)}},t}(egret.Sprite);__reflect(ImageLoader.prototype,"ImageLoader");var LoadingLayer=function(e){function t(){var t=e.call(this)||this;t.width=UIConfig.stageW,t.height=UIConfig.stageH;var n=new egret.Shape;return n.graphics.beginFill(0,.6),n.graphics.drawRoundRect(0,0,250,250,20),n.x=(t.width-n.width)/2,n.y=(t.height-n.height)/2,t.addChild(n),t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(LoadingLayer.prototype,"LoadingLayer");var Mask=function(e){function t(t){void 0===t&&(t=.5);var n=e.call(this)||this;return n.graphics.beginFill(0,t),n.graphics.drawRect(0,0,1,1),n.scaleX=UImanager.container.width+500,n.scaleY=UImanager.container.height+500,n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},n),n}return __extends(t,e),t}(egret.Shape);__reflect(Mask.prototype,"Mask");var Modal=function(e){function t(t,n){var a=e.call(this)||this;return a.width=t,a.height=n,a.bgMask=new Mask,a.addChild(a.bgMask),a.bgMask.x=-(UImanager.container.width-a.width)/2,a.bgMask.y=-(UImanager.container.height-a.height)/2,a.modalBg=new egret.Shape,a.modalBg.graphics.beginFill(16774565,1),a.modalBg.graphics.drawRect(0,0,t,n),a.modalBg.graphics.endFill(),a.addChild(a.modalBg),a.cirBg=new Bitmap({source:"pic_ax_fk_png"}),a.cirBg.x=(t-a.cirBg.width)/2,a.cirBg.y=(n-a.cirBg.height)/2+30,a.addChild(a.cirBg),a}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(Modal.prototype,"Modal");var ModalLayer=function(e){function t(t,n){var a=e.call(this)||this;return a.modal=new Modal(t,n),a.addChild(a.modal),a.addEventListener(egret.Event.ADDED_TO_STAGE,function(){egret.Tween.get(a).set({alpha:.3}).to({alpha:1},200)},a),a}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(ModalLayer.prototype,"ModalLayer");var Scroller=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(egret.ScrollView);__reflect(Scroller.prototype,"Scroller");var TextField=function(e){function t(t){var n=e.call(this)||this,a=n;return"string"==typeof t?a.text=t:"object"==typeof t&&(a.fontFamily=t.fontFamily||"PingFang SC,Microsoft YaHei",void 0!=t.text&&(a.text=t.text),void 0!=t.color&&(a.textColor=t.color),void 0!=t.size&&(a.size=t.size),void 0!=t.bold&&(a.bold=t.bold),void 0!=t.width&&(a.width=t.width),void 0!=t.height&&(a.height=t.height),void 0!=t.x&&(a.x=t.x),void 0!=t.y&&(a.y=t.y),t.rotation&&(a.rotation=t.rotation),void 0!=t.anchorCenter&&(a.anchorOffsetX=a.width/2),void 0!=t.anchorCenter&&(a.anchorOffsetY=a.height/2),void 0!=t.anchorOffsetX&&(a.anchorOffsetX=t.anchorOffsetX),void 0!=t.anchorOffsetY&&(a.anchorOffsetY=t.anchorOffsetY),void 0!=t.textAlign&&(a.textAlign=t.textAlign),void 0!=t.verticalAlign&&(a.verticalAlign=t.verticalAlign),void 0!=t.lineSpacing&&(a.lineSpacing=t.lineSpacing),void 0!=t.multiline&&(a.multiline=t.multiline)),n}return __extends(t,e),Object.defineProperty(t.prototype,"ID",{set:function(e){this.text="ID:"+e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"IP",{set:function(e){this.text="IP:"+e},enumerable:!0,configurable:!0}),t}(egret.TextField);__reflect(TextField.prototype,"TextField");var Car=function(e){function t(t,n){void 0===n&&(n=0);var a=e.call(this)||this;a.a1=.5,a.a2=1,a.speedX=10,a.speedY=0,a.dirX=0,a.maxSpeedY=60,a.flagMove=!0,a.flagDown=!1,a.carType=0,0==n&&(a.maxSpeedY=40),a.anistatus="normal",a.carType=n;var r;r="pic_car_"+t+"_png",a.bg=new Bitmap({source:r}),a.addChild(a.bg),a.anchorOffsetX=a.bg.width/2,a.anchorOffsetY=a.bg.height/2;var i=2==t?"hongche":"lanche";return a.aniCar=AnimateManager.createDragonBoneAni(i),a.aniCar.visible=!1,a.aniCar.x=36,a.aniCar.y=72,a.addChild(a.aniCar),a.aniCar.addEvent(dragonBones.AnimationEvent.COMPLETE,function(){console.log("\u52a8\u753b\u5b8c\u6210"),a.aniCar.visible=!1,"fuhuo"==a.anistatus&&(a.flagMove=!0,a.bg.visible=!0,a.anistatus="normal")},a),a.fListen(),a}return __extends(t,e),t.prototype.speedUp=function(){var e=!1;return this.speedY+=this.a1,this.speedY>this.maxSpeedY&&(this.speedY=this.maxSpeedY,e=!0),this.y-=this.speedY,e},t.prototype.slowDown=function(){return this.speedY<=0?void(this.speedY=0):(this.speedY-=this.a2,void(this.y-=this.speedY))},t.prototype.moveLeft=function(){this.x-=this.speedX},t.prototype.moveRight=function(){this.x+=this.speedX},t.prototype.moveX=function(){0==this.dirX||(1==this.dirX?this.moveLeft():2==this.dirX&&this.moveRight())},t.prototype.fListen=function(){var e=this;this.addEventListener("crash",function(t){var n=t.data;e.getCrash(n.speedX,n.speedY,n.type)},this)},t.prototype.getCrash=function(e,t,n){var a=this;this.flagMove=!1;var r=2200;this==myCar?EventManager.pub("playHitSound"):r=2400,"wall"==n?(this.playBoom(),setTimeout(function(){"baozha"==a.anistatus&&(a.x=375+UIConfig.offsetW,a.speedY=0,a.playReview())},r)):"npc"==n&&(this.playBoom(),setTimeout(function(){"baozha"==a.anistatus&&(a.x=375+UIConfig.offsetW,a.speedY=0,a.playReview())},r))},t.prototype.testCrash=function(){var e=!1,t=this.y-myCar.y;if(t<-UIConfig.stageH)e=!0;else if(t>400)e=!0;else if(Math.abs(t)<=myCar.height&&Math.abs(this.x-myCar.x)<=73){var n=myCar.speedX;this.x>=myCar.x&&(n=-n),"normal"==myCar.anistatus&&myCar.dispatchEventWith("crash",!1,{speedX:n,speedY:this.speedY-myCar.speedY,type:"npc"})}return e},t.prototype.playBoom=function(){this.bg.visible=!1,this.aniCar.visible=!0,this.aniCar.animation.play("baozha",1),this.anistatus="baozha",this.speedY=0},t.prototype.playReview=function(){this.bg.visible=!1,this.aniCar.visible=!0,this.aniCar.animation.play("fuhuo",1),this.anistatus="fuhuo"},t}(egret.Sprite);__reflect(Car.prototype,"Car");var Tree=function(e){function t(){return e.call(this)||this}return __extends(t,e),t}(egret.Bitmap);__reflect(Tree.prototype,"Tree");var ScoreBar=function(e){function t(t){var n,a=e.call(this)||this;return 0==t&&(n="pic_zdf_png"),1==t&&(n="pic_zpm_png"),a.sType=new Bitmap({source:n}),a.addChild(a.sType),a.sCont=new TextField({text:"123",size:36,color:16769362,width:130,height:36,textAlign:"center",verticalAlign:"middle"}),a.sCont.x=200,0==t&&(a.sCont.x=170),a.sCont.y=3,a.addChild(a.sCont),a}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this.sCont.text},set:function(e){this.sCont.text=e},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(ScoreBar.prototype,"ScoreBar");var BarBottom=function(e){function t(){var t=e.call(this)||this;return t.shapeBg=new egret.Shape,t.shapeBg.graphics.beginFill(0,.2),t.shapeBg.graphics.drawRect(0,0,UIConfig.stageW+100,50),t.shapeBg.graphics.endFill(),t.addChild(t.shapeBg),t.hScore=new ScoreBar(0),t.hScore.x=120,t.hScore.y=5,t.addChild(t.hScore),t.hRank=new ScoreBar(1),t.hRank.x=430,t.hRank.y=5,t.addChild(t.hRank),EventManager.sub("bottomBar/updataScore",function(){t.hScore.score=GameDataManager.score.toString(),t.hRank.score=GameDataManager.rank.toString()}),EventManager.sub("changeButtomBar",function(e){0==e?(t.hScore.visible=!1,t.hRank.visible=!1):(t.hScore.visible=!0,t.hRank.visible=!0)}),EventManager.pub("bottomBar/updataScore"),t}return __extends(t,e),t}(egret.Sprite);__reflect(BarBottom.prototype,"BarBottom");var RankBar=function(e){function t(){var t=e.call(this)||this;return t.rLogo=new Bitmap({source:"pic_redjt_png"}),t.addChild(t.rLogo),t.rCont=new TextField({fontFamily:"YouYuan",text:"\u589e\u52a0120\u5206",size:28,color:6627590,bold:!0}),t.rCont.x=t.rLogo.width+20,t.rCont.y=15,t.addChild(t.rCont),t}return __extends(t,e),Object.defineProperty(t.prototype,"score",{set:function(e){e>=0?(this.rCont.text="\u589e\u52a0"+e.toString()+"\u5206",this.rLogo.src="pic_redjt_png"):0>e&&(this.rCont.text="\u964d\u4f4e"+e.toString()+"\u5206",this.rLogo.src="pic_bluejt_png")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rank",{set:function(e){e>=0?(this.rCont.text="\u6392\u540d\u4e0a\u5347"+e.toString()+"\u540d",this.rLogo.src="pic_redjt_png"):0>e&&(this.rCont.text="\u6392\u540d\u4e0b\u964d"+e.toString()+"\u540d",this.rLogo.src="pic_bluejt_png")},enumerable:!0,configurable:!0}),t}(egret.Sprite);__reflect(RankBar.prototype,"RankBar");var TitleBar=function(e){function t(){var t=e.call(this)||this;return t.sBg=new Bitmap({source:"pic_banner_png"}),t.addChild(t.sBg),t.sCont=new TextField({fontFamily:"YouYuan",text:"\u4f60\u548cXX\u642d\u6863\u5728120\u79d2\u5171\u8ba1\u5e72\u6389\u4e86XX\u5bf9\u60c5\u4fa3",color:10897678,x:50,y:100,size:28,width:560,height:50,textAlign:"center",verticalAlign:"middle"}),t.addChild(t.sCont),t}return __extends(t,e),Object.defineProperty(t.prototype,"score",{get:function(){return this.sCont.text},set:function(e){this.sCont.text=e},enumerable:!0,configurable:!0}),t}(egret.DisplayObjectContainer);__reflect(TitleBar.prototype,"TitleBar");var GameDataManager={winScore:10,sio:"",gameType:0,dataSelf:{nick:"\u6211"},dataOpp:{nick:"\u73a9\u5bb6\u4e8c"},score:"123",rank:123,roomId:0,offsetH:0,robotId:null,robotPlayCount:0,lastRight:0,userID:"",oppID:"",selfColor:0,oppColor:0,oppIsRobot:!1,bSelfNoPosition:!1,bOppNoPosition:!1,turnSetChess:0,readyCount:0,firstID:"",chessBoardW:0,chessBoardH:0,chessScale:1,oppTid:0,selfTid:0,oppIsReady:!1,mapData:[],recoredSoundType:!0,lang:GetQueryString("lang")},LoginManager=function(){function e(){}return e.ajax=function(e){var t=e.type,n=e.data,a=e.url;return Util.Ajax({type:t,data:n,url:a})},e.sendMessage=function(e){var t=this,n=e.type,a=e.data,r=e.url;return new Promise(function(e,i){t.checkAjax().then(function(){t.ajax({type:n,data:a,url:r}).then(function(t){e(t)}).catch(function(){i()})})})},e.checkAjax=function(){var e=this;return new Promise(function(t,n){e.checkSession().then(function(){t()}).catch(function(){e.login().then(function(){t()}).catch(function(){n()})})})},e.checkSession=function(){var e=this;return new Promise(function(t,n){e.code?wx.checkSession({success:function(){console.log("\u767b\u9646\u6001\u672a\u8fc7\u671f"),t()},fail:function(){console.warn("\u767b\u9646\u6001\u8fc7\u671f"),n()}}):(console.warn("\u767b\u9646\u6001\u8fc7\u671f"),n())})},e.startGame=function(){this.sendMessage({url:"/gameplay/game/start",type:"get",data:{token:wxCenter.token}}).then(function(e){console.log(e),wxCenter.lastGameId=e.result})},e.getRank=function(){return new Promise(function(t,n){e.sendMessage({url:"/gameplay/game/rank",type:"get",data:{token:wxCenter.token,page:0,pageSize:20}}).then(function(e){wxCenter.rankList=e.result.list,wxCenter.selfRank=e.result.self,t()}).catch(function(){n()})})},e.endGame=function(e){this.sendMessage({url:"/gameplay/game/over/"+wxCenter.lastGameId,type:"get",data:{token:wxCenter.token,score:e}}).then(function(e){console.log(e)})},e.login=function(){return new Promise(function(t,n){wx.login({success:function(n){console.log(n.code),e.code=n.code;var a=wxCenter.userInfo;Util.Ajax({type:"post",url:"/gameplay/users/login",data:{avatarUrl:a.avatarUrl,city:a.city,code:e.code,country:a.country,device:"",gender:a.gender,nickName:a.nickName,province:a.province,registerIp:"",type:1e3}}).then(function(e){wxCenter.token=e.result.token,t()})},fail:function(){n()}})})},e.getUserInfo=function(){return new Promise(function(e,t){wx.getSetting({success:function(n){!n.authSetting["scope.userInfo"]&&wx.createUserInfoButton?wx.getSystemInfo({success:function(n){var a=n.screenHeight,r=n.screenWidth,i=r/a>750/1334?a/1334:r/750;EventManager.pub("togglePageAuth",!0);var o=wx.createUserInfoButton({type:"text",text:"\u767b\u9646",style:{left:(UIConfig.stageW-361)*i/2,top:(860+UIConfig.offsetH-50)*i,width:361*i,height:101*i,lineHeight:101*i,backgroundColor:"#ff6852",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:400}});EventManager.sub("togglePageAuth",function(e){e||o.hide()}),o.onTap(function(n){-1==n.errMsg.indexOf("fail")?(EventManager.pub("togglePageAuth",!1),e(n.userInfo)):t()})}}):wx.getUserInfo({success:function(t){e(t.userInfo),EventManager.pub("togglePageAuth",!1)},fail:function(){t()}})}})})},e.gameLogin=function(){var e=this;this.getUserInfo().then(function(t){wxCenter.userInfo=t;var n=wx.getOpenDataContext();n.postMessage({event:"setInfo",data:wxCenter.userInfo}),e.login()})},e.code="",e}();__reflect(LoginManager.prototype,"LoginManager"),window.LoginManager=LoginManager;var RobotCenter={playcount:0,init:function(){var e=this;EventManager.sub("RobotCenter/callToRobot",function(){console.log("\u673a\u5668\u4eba\u63a5\u6536\u6d88\u606f");var t=500*Math.random(),n=Math.floor(4*Math.random());0==n&&(n=1),setTimeout(function(){var t=Math.random();if(t>.5&&EventManager.pub("tiki/broadcastToAll","addBrick",{uid:GameDataManager.oppID,count:n}),console.log("\u673a\u5668\u4eba\u53d1\u9001\u6d88\u606f"),e.playcount++,e.playcount>15){var a=Math.floor(15*Math.random());1==a&&EventManager.pub("tiki/broadcastToAll","gameover",{winId:GameDataManager.robotId})}},t)}),EventManager.sub("resetRobotData",function(){e.playcount=0})}};RobotCenter.init();var wxCenter=function(){function e(){}return e.getMyBest=function(){var t=egret.localStorage.getItem("selfData")||"{}";t=JSON.parse(t);var n=+(t.score||0);e.bestScore=n},e.setMyBest=function(e){var t=egret.localStorage.getItem("selfData")||"{}";t=JSON.parse(t),t.score=e,egret.localStorage.setItem("selfData",JSON.stringify(t))},e.updateScore=function(t){if(t<=e.bestScore)return!1;e.bestScore=t,e.setMyBest(t);var n=Math.floor((new Date).getTime()/1e3),a={key:"rank",value:JSON.stringify({wxgame:{score:t,update_time:n}})};return wx.setUserCloudStorage({KVDataList:[a]}),!0},e.bestScore=0,e.userInfo={},e.token="",e.lastGameId=0,e.rankList=[],e.selfRank={sort:0,score:0},e}();__reflect(wxCenter.prototype,"wxCenter"),window.wxCenter=wxCenter;var RankLayer=function(e){function t(){var t=e.call(this)||this;t.wraps=[],t.menus=[],t.wrapSelfData=new egret.Sprite,t.currentMenu=0;var n=new Mask(.6);t.addChild(n),t.wrap=new egret.Sprite,t.addChild(t.wrap);var a=new Bitmap({source:"bg-rank_png",width:647,height:800}),r=new Bitmap({source:"bg-rank_png",width:647,height:134,y:900,x:(UIConfig.stageW-647)/2});t.addChild(r);var i=new Bitmap({source:"bg-rank_png",width:647,height:800,x:(UIConfig.stageW-647)/2,y:80});return t.addChild(i),t.wrap.mask=i,t.wrap.x=(UIConfig.stageW-647)/2,t.wrap.y=80,t.wrap.addChild(a),t.scroll=new egret.ScrollView,t.scroll.width=t.wrap.width,t.scroll.height=t.wrap.height-142,t.scroll.y=142,t.scroll.horizontalScrollPolicy="off",t.wrap.addChild(t.scroll),t.createMenus(),t.createMine(null,0),t.createRank(),t.changeCnt(0),EventManager.sub("updateRankMine",function(e,n){t.createMine(e,n)}),t}return __extends(t,e),t.prototype.createMine=function(e,t){this.wrapMine=new egret.Sprite,this.wrapMine.x=(UIConfig.stageW-647)/2,this.wrapMine.y=900,this.addChild(this.wrapMine),null!=e&&(this.wrapSelfData.removeChildren(),this.wrapSelfData=this.renderItem({name:wxCenter.userInfo.nickName,rank:""+e,avatar:wxCenter.userInfo.avatarUrl,score:t},0),this.wrapSelfData.visible=1==this.currentMenu,this.wrapSelfData.y=17,this.wrapMine.addChild(this.wrapSelfData))},t.prototype.createMenus=function(){var e=this,t=new egret.Sprite;t.x=61.5,t.y=20,this.wrap.addChild(t);var n=new Bitmap({source:"rank-menu0_png",width:524});t.addChild(n),["\u597d\u53cb\u6392\u884c\u699c","\u4e16\u754c\u6392\u884c\u699c"].forEach(function(n,a){var r=new Bitmap({source:"rank-menu1_png",x:262*a,width:262}),i=new TextField({size:31,color:16777215,width:262,textAlign:"center",height:64,verticalAlign:"middle",text:n,x:262*a});t.addChild(r),t.addChild(i),t.addEventListener("changeMenu",function(e){var t=e.data;r.visible=t==a,i.textColor=t==a?16777215:16359936},e),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.dispatchEventWith("changeMenu",!1,a),e.changeCnt(a)},e)}),t.dispatchEventWith("changeMenu",!1,0)},t.prototype.createRank=function(){var e=this,t=new egret.Sprite;this.wrap.addChild(t),t.x=50,t.y=100;var n=new Bitmap({source:"bg-yellow_png",x:-50,width:this.wrap.width});t.addChild(n);var a=new TextField({size:32,color:16359936,text:"\u6392\u540d                \u540d\u79f0                 \u8ddd\u79bb(\u7c73)",y:2});t.addChild(a),this.renderFriend(),this.renderRank(1);var r=new Button({"default":"btn-bg-org_png",x:UIConfig.stageW/2,y:1110,touchScale:.9}),i=new Bitmap({source:"txt-fhdt_png",x:92,y:30});r.addChild(i),this.addChild(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UImanager.hideRank(),UImanager.hideResult(),EventManager.pub("hideStartLayer")},this);var o=new Button({"default":"btn-bg-red_png",x:UIConfig.stageW/2,y:1230,touchScale:.9}),s=new Bitmap({source:"txt-zlyj_png",x:92,y:30});o.addChild(s),this.addChild(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UImanager.hideRank(),UImanager.hideResult(),EventManager.pub("startGame")},this),EventManager.sub("updateRank",function(){e.renderRank(1)})},t.prototype.renderRank=function(e,t){var n=this;void 0===t&&(t=wxCenter.rankList),this.wraps[e]=this.wraps[e]||new egret.Sprite;var a=this.wraps[e];a.removeChildren(),t.forEach(function(e,t){console.log(e);var r=n.renderItem({rank:e.sort,name:e.nickname,score:e.score,avatar:e.avatarUrl},t);a.addChild(r)}),this.scroll.setContent(this.wraps[1])},t.prototype.renderFriend=function(){this.wraps[0]=new egret.Sprite;var e=new egret.BitmapData(window.sharedCanvas);e.$deleteSource=!1;var t=new egret.Texture;t._setBitmapData(e);var n=new egret.Bitmap(t);n.fillMode=egret.BitmapFillMode.SCALE;var a=this.wrap.width/n.width;n.width*=a,n.height*=a,this.wraps[0].addChild(n),egret.startTick(function(){return egret.WebGLUtils.deleteWebGLTexture(e.webGLTexture),e.webGLTexture=null,!1},this),this.addChild(this.wraps[0]),this.wraps[0].y=202},t.prototype.renderItem=function(e,t){var n=new egret.Sprite;n.y=100*t;var a=new Bitmap({source:"bg-yellow_png",width:this.wrap.width,height:100});if(n.addChild(a),a.alpha=t%2==0?0:1,e.rank<4){var r=new Bitmap({source:"rank-icon"+e.rank+"_png",x:40,y:18});n.addChild(r)}else{var r=new TextField({bold:!0,size:40,x:45,width:57,textAlign:"center",height:100,verticalAlign:"middle",text:e.rank.toString(),color:0});n.addChild(r)}var i=new ImageLoader({width:60,height:60,src:e.avatar,x:170,y:20});n.addChild(i);var o=new TextField({size:32,color:0,text:e.name,x:240,height:100,verticalAlign:"middle"});n.addChild(o);var s=new TextField({size:40,color:0,text:e.score.toString(),x:430,width:220,textAlign:"center",height:100,verticalAlign:"middle",bold:!0});return n.addChild(s),n},t.prototype.changeCnt=function(e){this.currentMenu=e,this.wrapSelfData&&(this.wrapSelfData.visible=1==e),this.scroll.visible=1==e,this.wraps[0].visible=0==e;var t=wx.getOpenDataContext();t.postMessage({event:"changeRank"})},t}(egret.DisplayObjectContainer);__reflect(RankLayer.prototype,"RankLayer");var ResultLayer=function(e){function t(){var t=e.call(this)||this,n=new Mask(.5);t.addChild(n),t.wrap=new egret.Sprite,t.addChild(t.wrap);var a=new Bitmap({source:"bg-rank_png",width:647,height:530});t.wrap.addChild(a),t.wrap.x=(UIConfig.stageW-647)/2,t.wrap.y=304;var r=new Bitmap({source:"rank-title_png",x:222,y:70});t.wrap.addChild(r),t.spScore=new BitmapText({source:"fnt_rank_fnt",text:"0",width:t.wrap.width,textAlign:"center",y:220}),t.wrap.addChild(t.spScore);var i=new Bitmap({source:"rank-dec_png",x:50,y:150});t.wrap.addChild(i);var o=new Bitmap({source:"rank-yellow_png",width:t.wrap.width,height:60});o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2,o.rotation=180,o.x=t.wrap.width/2,o.y=t.wrap.height-o.height/2,t.wrap.addChild(o);var s=new Button({"default":"sign-rank2_png",touchScale:.9,y:500,x:t.wrap.width/2});t.wrap.addChild(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UImanager.showRank()},t),t.tagNew=new Bitmap({source:"tag-new_png",x:221,y:-40}),t.wrap.addChild(t.tagNew);var c=new Button({"default":"btn-bg-org_png",x:UIConfig.stageW/2,y:950,touchScale:.9}),h=new Bitmap({source:"sign-share_png",x:92,y:30});c.addChild(h),t.addChild(c);var d=new Button({"default":"btn-bg-red_png",x:UIConfig.stageW/2,y:1100,touchScale:.9}),l=new Bitmap({source:"txt-zlyj_png",x:92,y:30});return d.addChild(l),t.addChild(d),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EventManager.pub("startGame"),UImanager.hideResult()},t),t}return __extends(t,e),t.prototype.setScore=function(e,t){void 0===e&&(e=0),void 0===t&&(t=!1),this.spScore.text=e.toString(),this.tagNew.visible=t},t}(egret.DisplayObjectContainer);__reflect(ResultLayer.prototype,"ResultLayer");var StartLayer=function(e){function t(){var t=e.call(this)||this;t.width=UIConfig.stageW,t.height=UIConfig.stageH;var n=new egret.Shape;n.graphics.beginFill(0,.5),n.graphics.drawRect(0,0,UIConfig.stageW,UIConfig.stageH),n.graphics.endFill(),t.addChild(n);var a=new Bitmap({source:"startlayer-title_png",y:250+UIConfig.offsetH});a.x=(UIConfig.stageW-a.width)/2,t.addChild(a),t.btn_start=new Button({"default":"btn-bg-red_png",touchScale:.9}),t.btn_start.y=860+UIConfig.offsetH,t.btn_start.x=UIConfig.stageW/2,t.addChild(t.btn_start);var r=new Bitmap({source:"btn-sign-start_png"});
r.x=(t.btn_start.width-r.width)/2,r.y=(t.btn_start.height-r.height)/2,t.btn_start.addChild(r),t.btn_start.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){EventManager.pub("startGame")},t),t.btn_lookrank=new Button({"default":"sign-rank_png",touchScale:.9}),t.btn_lookrank.y=950+UIConfig.offsetH,t.btn_lookrank.x=UIConfig.stageW/2,t.btn_lookrank.visible=!1,t.addChild(t.btn_lookrank),t.btn_lookrank.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UImanager.showRank()},t);var i=new TextField({size:28,color:16777215,text:"\u767b\u9646\u540e\u624d\u53ef\u4ee5\u8fdb\u884c\u6e38\u620f\u54e6~",y:937+UIConfig.offsetH,width:t.width,textAlign:"center"});return i.visible=!1,t.addChild(i),EventManager.sub("togglePageAuth",function(e){t.btn_start.visible=!e,t.btn_lookrank.visible=!e,i.visible=e}),t}return __extends(t,e),t}(egret.Sprite);__reflect(StartLayer.prototype,"StartLayer");var AnimateManager=function(){function e(){}return e.circleMove=function(e,t,n,a,r,i,o){return void 0===a&&(a=360),void 0===r&&(r=0),void 0===i&&(i=2e3),void 0===o&&(o=!0),__awaiter(this,void 0,void 0,function(){var s;return __generator(this,function(){return s=function(){this.x=t.x+n*Math.cos(this.angle*Math.PI/180),this.y=t.y-n*Math.sin(this.angle*Math.PI/180)},egret.Tween.get(e,{onChange:s,onChangeObj:e,loop:o}).set({angle:a,x:t.x+n*Math.cos(a*Math.PI/180),y:t.y-n*Math.sin(a*Math.PI/180)}).to({angle:r},i),[2]})})},e.createDragonBoneAni=function(e,t,n,a){void 0===t&&(t=0),void 0===n&&(n=0),void 0===a&&(a=""),a=a||e;var r;r=new dragonBones.EgretFactory,r.parseDragonBonesData(RES.getRes(e+"_ske_json")),r.parseTextureAtlasData(RES.getRes(e+"_tex_json"),RES.getRes(e+"_tex_png"));var i=r.buildArmatureDisplay(a);return t&&(i.scaleX=t/i.width),n&&(i.scaleY=n/i.height),i},e}();__reflect(AnimateManager.prototype,"AnimateManager");var GameData=function(){function e(){}return e}();__reflect(GameData.prototype,"GameData");var UIConfig=function(){function e(){}return e.useTransition=!0,e.width=750,e.height=1334,e.stageW=0,e.stageH=0,e.offsetW=0,e.offsetH=0,e.sceneScaleWidth=1,e.sceneScaleHeight=1,e.deviceWidth=0,e.deviceHeight=0,e}();__reflect(UIConfig.prototype,"UIConfig");var UIManager=function(){function e(e){this.info={},this.setContainer(e)}return e.prototype.fListen=function(){var e=this,t=this;EventManager.sub("modal/onShowModal",function(e,n){void 0===n&&(n={}),t.showModal(e,n)}),EventManager.sub("modal/onModalClose",function(){e.currentModal&&(e.currentModal.parent?(egret.Tween.removeTweens(e.currentModal),egret.Tween.get(e.currentModal).to({alpha:0},200).call(function(){e.currentModal.parent&&e.container.removeChild(e.currentModal),e.currentModal=void 0})):e.currentModal=void 0)}),EventManager.sub("modal/onCloseOffline",function(){e.modalOffline&&e.modalOffline.parent&&e.container.removeChild(e.modalOffline)}),EventManager.sub("modal/onShowOffline",function(t){void 0===t&&(t={}),e.modalOffline=e.modalOffline||new OfflineModal,e.modalOffline.spText.text=t.text,e.container.addChildAt(e.modalOffline,50)})},e.prototype.setContainer=function(e){this.container=e;var t=egret.MainContext.instance.stage;switch(UIConfig.stageW=t.stageWidth,UIConfig.stageH=t.stageHeight,UIConfig.deviceHeight=egret.Capabilities.boundingClientHeight,UIConfig.deviceWidth=egret.Capabilities.boundingClientWidth,UIConfig.deviceWidth){case 320:UIConfig.deviceWidth*=2;break;case 375:UIConfig.deviceWidth*=2;break;case 414:UIConfig.deviceWidth*=2}UIConfig.offsetW=(t.stageWidth-UIConfig.width)/2,UIConfig.offsetH=(UIConfig.stageH-UIConfig.height)/2,this.container.width=UIConfig.stageW,this.container.height=UIConfig.stageH;var n=.96,a=720/959;GameDataManager.chessBoardW=UIConfig.stageW*n,GameDataManager.chessBoardH=UIConfig.stageH*a,console.log("\u5b9e\u9645\u573a\u666f\u5927\u5c0f\uff1a",UIConfig.stageW,UIConfig.stageH),console.log("\u5b9e\u9645\u68cb\u76d8\u7684\u5bbd\u9ad8\uff1a",UIConfig.stageW*n,UIConfig.stageH*a),this.fListen()},e.prototype.showModal=function(e,t){void 0===t&&(t={});var n;switch(e){case 0:break;case 1:break;case 2:break;case 3:}this.currentModal&&(this.container.removeChild(this.currentModal),this.currentModal=void 0),n?(this.currentModal=n,this.container.addChildAt(n,50),1==t.type?EventManager.pub("startCT",1):2==t.type&&EventManager.pub("startCT",2)):console.warn("modal\u7c7b\u578b\u672a\u5b9a\u4e49")},e.prototype.to=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(){switch(e){case"hall":case"game":console.log("\u8fdb\u5165\u6e38\u620f\u573a\u666f"),this.sceneGame=this.sceneGame||new SceneGame,this.add(this.sceneGame);break;case"over":}return[2]})})},e.prototype.add=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return this.currentScene?this.currentScene==e?(this.currentScene.onLeave&&this.currentScene.onLeave(),this.currentScene.onEnter&&this.currentScene.onEnter(),[2]):[4,this.remove(this.currentScene)]:[3,2];case 1:n.sent(),console.log("====\u539f\u573a\u666f\u5df2\u79fb\u9664===="),n.label=2;case 2:return t=e.onEnter||new Function,e.once(egret.Event.ADDED_TO_STAGE,t,e),this.container.addChildAt(e,0),console.log("====\u52a0\u8f7d\u65b0\u573a\u666f\u6210\u529f===="),this.currentScene=e,UIConfig.useTransition?[4,this.transform(e)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}})})},e.prototype.remove=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return this.container.contains(e)?UIConfig.useTransition?[4,this.transform(e,!1)]:[3,2]:[3,3];case 1:t.sent(),t.label=2;case 2:e.onLeave&&e.onLeave(),e&&e.parent&&this.container.removeChild(e),this.currentScene=void 0,t.label=3;case 3:return[2]}})})},e.prototype.transform=function(e,t,n){return void 0===t&&(t=!0),void 0===n&&(n=300),__awaiter(this,void 0,void 0,function(){var a,r,i;return __generator(this,function(o){switch(o.label){case 0:return a={alpha:0},r={alpha:1},t||(i=[r,a],a=i[0],r=i[1]),[4,function(){return new Promise(function(t){egret.Tween.get(e).set(a).to(r,n).call(function(){t()})})}()];case 1:return o.sent(),[2]}})})},e.prototype.createFrames=function(e){var t=new egret.MovieClipDataFactory(RES.getRes(e+"_json"),RES.getRes(e+"_png")),n=new egret.MovieClip(t.generateMovieClipData(e));return n},e.prototype.showResult=function(e,t){void 0===t&&(t=!1),this.layerResult=this.layerResult||new ResultLayer,this.layerResult.setScore(e,t),this.container.addChild(this.layerResult)},e.prototype.hideResult=function(){this.layerResult&&this.layerResult.parent&&this.container.removeChild(this.layerResult)},e.prototype.showRank=function(){this.layerRank=this.layerRank||new RankLayer,this.container.addChild(this.layerRank),this.layerRank.changeCnt(0),LoginManager.getRank().then(function(){EventManager.pub("updateRank"),EventManager.pub("updateRankMine",wxCenter.selfRank.sort,wxCenter.selfRank.score)})},e.prototype.hideRank=function(){this.layerRank&&this.layerRank.parent&&this.container.removeChild(this.layerRank)},e}();__reflect(UIManager.prototype,"UIManager");var UImanager,totalLen=1e5,myCar,oppCar,npcCars=[],trees=[],SceneGame=function(e){function t(){var t=e.call(this)||this;t.bg=new egret.Bitmap(RES.getRes("bg_png")),t.stageCenter=0,t.treePlantY=0,t.robotDir="left",t.timer=null,t.daojishi=300;return t.init(),t.fListen(),t}return __extends(t,e),t.prototype.initLayer=function(){this.startLayer=new StartLayer,this.addChild(this.startLayer)},t.prototype.init=function(){this&&this.removeChildren(),this.ani321Timer=new egret.Timer(1e3,3),this.bg.x=0,this.bg.y=0,this.bg.width=UIConfig.stageW,this.bg.height=UIConfig.stageH,this.addChild(this.bg),this.timeBar_btm=new Bitmap({source:"bar-time-bule_png",width:530,height:23}),this.timeBar_btm.scale9Grid=new egret.Rectangle(12,10,20,3),this.barWrap=new egret.Sprite,this.barWrap.height=636,this.barWrap.x=(UIConfig.stageW-this.barWrap.width)/2,this.barWrap.addChild(this.timeBar_btm),this.timeBar_top=new Bitmap({source:"bar-time-yellow_png",width:530,height:23}),this.timeBar_top.scale9Grid=new egret.Rectangle(12,10,20,3),this.barWrap.addChild(this.timeBar_top),this.timeBar_btm.x=78+UIConfig.offsetW,this.timeBar_btm.y=-310,this.timeBar_top.x=78+UIConfig.offsetW,this.timeBar_top.y=-310;var e=new Bitmap({source:"bar-time-sign_png"});e.x=this.timeBar_btm.x-e.width/2+UIConfig.offsetW,e.y=-325,this.barWrap.addChild(e),this.distance=new BitmapText({source:"white1_fnt",text:"0M",width:500,textAlign:"center",y:-280}),this.distance.x=90+UIConfig.offsetW,this.barWrap.addChild(this.distance),this.barWrap.x=35,this.barWrap.y=UIConfig.stageH-950,this.stageCenter=UIConfig.stageH/2,this.streetWrap=new egret.Sprite,this.streetWrap.width=UIConfig.stageW,this.addChild(this.streetWrap),this.streetWrap.y=UIConfig.stageH;var t=new Bitmap({source:"bg_png",width:UIConfig.stageW,height:totalLen+2*UIConfig.stageH,x:UIConfig.offsetW});t.fillMode=egret.BitmapFillMode.REPEAT,t.y=UIConfig.stageH-t.height,this.streetWrap.addChild(t);var n=new Bitmap({source:"pic_xian_png"});n.x=(UIConfig.stageW-n.width)/2,n.y=-totalLen,this.streetWrap.addChild(n),this.touchLayer=new egret.Shape,this.touchLayer.graphics.beginFill(16777215,0),this.touchLayer.graphics.drawRect(0,0,UIConfig.stageW,UIConfig.stageH),this.touchLayer.graphics.endFill(),this.touchLayer.touchEnabled=!0,this.addChild(this.touchLayer),this.touchLayer.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){myCar.dirX=e.localX<=UIConfig.stageW/2?1:2},this),this.touchLayer.addEventListener(egret.TouchEvent.TOUCH_END,function(){myCar.dirX=0},this),this.touchLayer.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){myCar.dirX=0},this),this.addChild(this.barWrap);var a=new Bitmap({source:"pic_xian_png"});a.x=(UIConfig.stageW-a.width)/2,a.y=-290,this.streetWrap.addChild(a),myCar=new Car(2,1),this.streetWrap.addChild(myCar),myCar.x=UIConfig.stageW/2,myCar.y=-130,this.hitBgm=RES.getRes("carcrash_mp3"),this.startLayer=new StartLayer,this.addChild(this.startLayer)},t.prototype.startinit=function(){this.streetWrap.y=UIConfig.stageH,myCar.x=UIConfig.stageW/2,myCar.y=-130},t.prototype.createTree=function(e){void 0===e&&(e=0);for(var t=8,n=e||myCar.y-UIConfig.stageH+200,a=0;t>a;a++){var r=Util.RandomNumBoth(1,9),i=4>=r?!0:!1,o=new Bitmap("pic_lb_"+r+"_png");o.y=n-UIConfig.stageH*a/t;var s=Math.random()<.5?1:-1,c=0;-1==s?(c=Util.RandomNumBoth(0,53+UIConfig.offsetW),o.scaleX=-1,c+=o.width,i&&(c=o.width)):(c=Util.RandomNumBoth(566+UIConfig.offsetW,UIConfig.stageW-127),i&&(c=UIConfig.stageW-o.width)),o.x=c,this.streetWrap.addChild(o),trees.push(o)}},t.prototype.testTreePass=function(){var e=0!=trees.length;trees.forEach(function(t){t.y-myCar.y<=500&&(e=!1)}),e&&(trees.forEach(function(e){e.parent&&e.parent.removeChild(e)}),trees=[])},t.prototype.shuffle=function(e){for(var t,n,a=e.length;a;t=Math.floor(Math.random()*a),n=e[--a],e[a]=e[t],e[t]=n);return e},t.prototype.createNpcCar=function(){for(var e=3,t=3,n=1.4*UIConfig.stageH,a=this.shuffle([0,1,2,3]),r=0;e>r;r++){var i=new Car(Util.RandomNumBoth(4,7)),o=myCar.y-UIConfig.stageH+200;i.y=Util.RandomNumBoth(o,o-n/2+200),i.speedY=Util.RandomNumBoth(2*i.maxSpeedY/3,i.maxSpeedY);i.x=180+myCar.width/2+396*a[r]/4+UIConfig.offsetW,this.streetWrap.addChild(i),npcCars.push(i)}for(var s=this.shuffle([0,1,2,3]),r=0;t>r;r++){var i=new Car(Util.RandomNumBoth(4,7)),o=myCar.y-UIConfig.stageH+200;i.y=Util.RandomNumBoth(o-n/2,o-n),i.speedY=Util.RandomNumBoth(2*i.maxSpeedY/3,i.maxSpeedY);i.x=180+myCar.width/2+396*s[r]/4+UIConfig.offsetW,this.streetWrap.addChild(i),npcCars.push(i)}},t.prototype.npcAutoMove=function(){var e=0!=npcCars.length;npcCars.forEach(function(t){t.speedUp();var n=t.testCrash();n||(e=!1)}),e&&(npcCars.forEach(function(e){e.parent&&e.parent.removeChild(e)}),npcCars=[])},t.prototype.startGame=function(){var e=this;LoginManager.startGame(),this.clearTimer(),this.timer=setInterval(function(){if(e.enterFrame(),e.daojishi>0)e.daojishi--,e.setProcess();else{var t=Util.getScore();e.gameOverInit();var n=wxCenter.updateScore(t);UImanager.showResult(t,n),LoginManager.endGame(t)}},33)},t.prototype.enterFrame=function(){if(this.treePlantY-myCar.y>UIConfig.stageH&&(this.treePlantY=myCar.y,this.createTree()),this.testTreePass(),this.npcAutoMove(),myCar.flagMove){var e=myCar.speedUp();e&&0==npcCars.length&&this.createNpcCar(),myCar.moveX(),this.streetWrap.y=-myCar.y+UIConfig.stageH-300,myCar.y<=-totalLen&&(myCar.flagMove=!1),EventManager.pub("testCrash")}else myCar.flagDown&&(myCar.slowDown(),myCar.moveX(),this.streetWrap.y=-myCar.y+UIConfig.stageH-300,myCar.y<=-totalLen&&(myCar.flagMove=!1))},t.prototype.oppHroMove=function(){var e=Math.random()>.95?!0:!1;e&&(this.robotDir="left"==this.robotDir?"right":"left"),"left"==this.robotDir?oppCar.x<=216.5+UIConfig.offsetW?oppCar.x+=1:oppCar.x-=1:oppCar.x>=529.5+UIConfig.offsetW?oppCar.x-=1:oppCar.x+=1},t.prototype.setProcess=function(){this.timeBar_top.width=this.daojishi/1800*530,this.distance.text=""+Util.getScore()+"M"},t.prototype.checkOver=function(){},t.prototype.checkRobotOver=function(){},t.prototype.startRobot=function(){},t.prototype.startACT=function(){this.ani321Timer.repeatCount=3,this.ctCount=3,this.ani321Timer.addEventListener(egret.TimerEvent.TIMER,this.subTime,this),this.ani321Timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timeOver,this),this.ani321Timer.reset(),this.ani321Timer.start(),this.arrow.visible=!0,egret.Tween.get(this.arrow,{loop:!0}).set({alpha:1}).to({alpha:0},500).to({alpha:1},500)},t.prototype.subTime=function(){0!=this.ctCount&&(this.ctCount-=1,2==this.ctCount?this.aniNum.texture=RES.getRes("pic_2_png"):1==this.ctCount&&(this.aniNum.texture=RES.getRes("pic_1_png")))},t.prototype.timeOver=function(){egret.Tween.removeTweens(this.arrow),this.arrow.visible=!1,this.qiziLeft.visible=!1,this.qiziRight.visible=!1,this.aniNum.visible=!1,this.tipL.visible=!1,this.tipR.visible=!1,this.tipHand.visible=!1,this.tipHnadother.visible=!1},t.prototype.fListen=function(){var e=this;EventManager.sub("playHitSound",function(){e.hitsoundChannel=e.hitBgm.play(0,1)}),EventManager.sub("oppMoveX",function(e){oppCar.dirX=e.dirX}),EventManager.sub("startGame",function(){console.log("startGame"),e.startinit(),e.createTree(-800),e.changeLayer(1),e.startGame()}),EventManager.sub("resetGame",function(){e.startinit(),EventManager.pub("togglePageAuth",!1)}),EventManager.sub("testCrash",function(){myCar.x<=216.5+UIConfig.offsetW?myCar.dispatchEventWith("crash",!1,{speedX:10,speedY:0,type:"wall"}):myCar.x>=529.5+UIConfig.offsetW&&myCar.dispatchEventWith("crash",!1,{speedX:-10,speedY:0,type:"wall"})}),EventManager.sub("oppCrash",function(e){oppCar.dispatchEventWith("crash",!1,e)}),EventManager.sub("hideStartLayer",function(){e.changeLayer(2)})},t.prototype.changeLayer=function(e){this.startLayer.visible=1==e?!1:!0},t.prototype.initStatus=function(){GameDataManager.oppIsReady=!1,GameDataManager.mapData=[]},t.prototype.clearStage=function(){},t.prototype.clearTimer=function(){clearInterval(this.timer),this.timer=null,this.daojishi=1800},t.prototype.gameOverInit=function(){console.log("\u6e38\u620f\u91cd\u65b0\u521d\u59cb\u5316"),this.initStatus(),this.clearTimer()},t.prototype.onEnter=function(){},t.prototype.onLeave=function(){},t}(egret.DisplayObjectContainer);__reflect(SceneGame.prototype,"SceneGame");var Util=function(){function e(){}return e.parseData=function(e){e=e||{};var t="";for(var n in e)"object"==typeof e[n]&&(e[n]=JSON.stringify(e[n])),t+=n+"="+e[n],t+="&";return t?t.slice(0,-1):t},e.Ajax=function(t){var n=this;t.data=t.data||t.params||{},t.type=t.type||t.method||"get",t.fail=t.fail||function(){},t.success=t.success||function(){},t.type=t.type.toLowerCase(),t.method&&t.method.toLowerCase(),t.sendType&&t.sendType.toLowerCase();var a="post"==t.type?egret.HttpMethod.POST:egret.HttpMethod.GET,r=t.sendType||t.type,i="";i=t.url.indexOf("http")>-1?t.url:e.host+t.url,"get"==r&&(i+="?"+e.parseData(t.data));var o=new egret.HttpRequest;return o.responseType=egret.HttpResponseType.TEXT,o.open(""+i,a),o.setRequestHeader("Accept","application/json, text/plain,*/*"),t.headers&&void 0!=t.headers["Content-Type"]&&o.setRequestHeader("Content-Type",t.headers["Content-Type"]),"get"==r?o.send():o.send(t.data),new Promise(function(e,a){o.once(egret.Event.COMPLETE,function(n){var r=n.currentTarget,o=JSON.parse(r.response);1001==o.code?(t.success(o.data),e(o)):(t.fail(o),a(o),console.log(o,"\u8bf7\u6c42\u8fd4\u56de\u9519\u8bef",i))},n),o.once(egret.IOErrorEvent.IO_ERROR,function(){t.fail({message:"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01",code:500}),a({message:"\u7f51\u7edc\u9519\u8bef\uff0c\u8bf7\u91cd\u8bd5\uff01",code:500})},n)})},e.getScore=function(){return Math.abs(Math.floor(myCar.y/10))},e.formatFloat=function(e,t){var n=parseInt(e);return n.toFixed(t)},e.parseClock=function(e){var t=this.clockNum(Math.floor(e/60)),n=this.clockNum(e%60);return t+":"+n},e.clockNum=function(e){return("00"+e).slice(-2)},e.RandomNumBoth=function(e,t){var n=t-e,a=Math.random(),r=e+Math.round(a*n);return r},e.host="https://xcx.genghaojia.me",e}();__reflect(Util.prototype,"Util"),window.Main=Main;